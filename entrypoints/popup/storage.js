import * as Carmentis   from '../../lib/carmentis-server-sdk.js';

const fileSystem = Carmentis.util.fileSystem;

let dir = fileSystem.directory("WALLET"),
    uid,
    encryptionKey;

// ============================================================================================================================ //
//  setUser()                                                                                                                   //
// ============================================================================================================================ //
export function setUser(userId) {
  uid = "walletFile" + userId;
}

// ============================================================================================================================ //
//  setKey()                                                                                                                    //
// ============================================================================================================================ //
export function setKey(key) {
  encryptionKey = key;
}

// ============================================================================================================================ //
//  exists()                                                                                                                    //
// ============================================================================================================================ //
export async function exists(file) {
  return await dir.byUid(uid, file).exists();
}

// ============================================================================================================================ //
//  read()                                                                                                                      //
// ============================================================================================================================ //
export async function read(file) {
  let encryptedData = await dir.byUid(uid, file).read();
  return await encryptionKey.decrypt(encryptedData);
}

// ============================================================================================================================ //
//  write()                                                                                                                     //
// ============================================================================================================================ //
export async function write(file, data) {
  let encryptedData = await encryptionKey.encrypt(data);
  return await dir.byUid(uid, file).write(encryptedData);
}

// ============================================================================================================================ //
//  del()                                                                                                                       //
// ============================================================================================================================ //
export async function del(file) {
  return await dir.byUid(uid, file).del();
}
